root@otssTestServer:/home/lx/git/test# vagrant ssh
[vagrant@vm-gkuOA1801016 ~]$ sudo -i
[root@vm-gkuOA1801016 ~]# sudo useradd otus
[root@vm-gkuOA1801016 ~]# echo "123"|sudo passwd --stdin otus
Changing password for user otus.
passwd: all authentication tokens updated successfully.
[root@vm-gkuOA1801016 ~]# yum -y -q install nano
Failed to set locale, defaulting to C
No Presto metadata available for base
warning: /var/cache/yum/x86_64/7/base/packages/nano-2.3.1-10.el7.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY
Public key for nano-2.3.1-10.el7.x86_64.rpm is not installed
Importing GPG key 0xF4A80EB5:
 Userid     : "CentOS-7 Key (CentOS 7 Official Signing Key) <security@centos.org>"
 Fingerprint: 6341 ab27 53d7 8a78 a7c2 7bb1 24c6 a8a7 f4a8 0eb5
 Package    : centos-release-7-8.2003.0.el7.centos.x86_64 (@anaconda)
 From       : /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7
[root@vm-gkuOA1801016 ~]# groupadd admin
[root@vm-gkuOA1801016 ~]# usermod -a -G admin otus
[root@vm-gkuOA1801016 ~]# usermod -g admin otus
[root@vm-gkuOA1801016 ~]# id otus
uid=1001(otus) gid=1002(admin) groups=1002(admin)
[root@vm-gkuOA1801016 ~]# nano /etc/security/time.conf
[root@vm-gkuOA1801016 ~]# nano /etc/pam.d/sshd
[root@vm-gkuOA1801016 ~]# nano /etc/pam.d/sshd
[root@vm-gkuOA1801016 ~]# date
Sat Sep 25 17:29:57 UTC 2021
[root@vm-gkuOA1801016 ~]# useradd otus2
[root@vm-gkuOA1801016 ~]# echo "123"|sudo passwd --stdin otus2
Changing password for user otus2.
passwd: all authentication tokens updated successfully.
[root@vm-gkuOA1801016 ~]# sed -i 's/^PasswordAuthentication.*$/PasswordAuthentication yes/' /etc/ssh/sshd_config && systemctl restart sshd.service
[root@vm-gkuOA1801016 ~]# ssh otus@127.0.0.1
The authenticity of host '127.0.0.1 (127.0.0.1)' can't be established.
ECDSA key fingerprint is SHA256:Leplsl9ynIEYcWgKSdKHDX0hTjuyhmn78Jw8N/muyYM.
ECDSA key fingerprint is MD5:e6:88:cb:9b:5f:e5:19:b6:3e:62:74:68:56:4a:fb:41.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '127.0.0.1' (ECDSA) to the list of known hosts.
otus@127.0.0.1's password:
[otus@vm-gkuOA1801016 ~]$ logout
Connection to 127.0.0.1 closed.
[root@vm-gkuOA1801016 ~]# ssh otus2@127.0.0.1
otus2@127.0.0.1's password:
Authentication failed.
[root@vm-gkuOA1801016 ~]# cat /etc/security/time.conf | grep -v '#' | grep -v '^$'
sshd;*;!vagrant;!Wd0000-2400
[root@vm-gkuOA1801016 ~]# cat /etc/pam.d/sshd
#%PAM-1.0
auth       required     pam_sepermit.so
auth       substack     password-auth
auth       include      postlogin
# Used with polkit to reauthorize users in remote sessions
-auth      optional     pam_reauthorize.so prepare
account    required     pam_nologin.so
account    sufficient   pam_succeed_if.so gid eq 1002
account    required     pam_time.so
account    include      password-auth
password   include      password-auth
# pam_selinux.so close should be the first session rule
session    required     pam_selinux.so close
session    required     pam_loginuid.so
# pam_selinux.so open should only be followed by sessions to be executed in the user context
session    required     pam_selinux.so open env_params
session    required     pam_namespace.so
session    optional     pam_keyinit.so force revoke
session    include      password-auth
session    include      postlogin
# Used with polkit to reauthorize users in remote sessions
-session   optional     pam_reauthorize.so prepare